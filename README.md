# pasvulkan

Vulkan header generator and Vulkan OOP-style API wrapper for Object Pascal (FreePascal >= 3.0.2 (and FreePascal >= 3.1.1 for the Android target for the hardfloat calling convention keyword) and Delphi >= 7.0)

## Features

- C-API-style Vulkan header (Vulkan.pas which is generated by vkxml2pas.dpr)
    - It's always up-to-date, since it's auto-generated through the vkxml2pas.dpr
    - Supported platforms:
        - Windows (x86-32, x86-64)
        - Android (x86-32, x86-64, ARM)
        - Linux (x86-32, x86-64, ARM)
            - X11
            - Mir
            - Wayland
        - MoltenVK wrapper (untested)
            - iOS
            - MacOS
- OOP-based Vulkan Framework (PasVulkan.pas)
    - Object oriented Vulkan API abstraction
    - Best-fit red-black-tree based memory manager for the Vulkan memory management, for to manage the sub-allocations in the allocated buffers and for to keep the total count of simultaneous live allocations as much low as possible and less than TVkPhysicalDeviceLimits.maxMemoryAllocationCount.
    - Texture loaders with own loader implementations, so it is independent of external third-party image loaders, even independent of the VCL, LCL and FCL.  
        -  BMP (untested, but it should work)
        -  DDS
        -  HDR
        -  KTX
        -  JPG / JPEG (only baseline, only Huffman-coded and only YCrCb at the moment now) 
        -  PNG (all types, including 16-bit channel PNGs)
        -  TGA
    - Optional automatic GPU-based texture mipmap generation (with help of vkCmdBlitImage)
    - and more useful utils and stuff for Vulkan-programming
    - Supported platforms:
        - Windows (x86-32, x86-64)
        - Android (x86-32, x86-64, ARM)
        - Linux (x86-32, x86-64, ARM)
            - X11
            - Mir
            - Wayland
        - MoltenVK wrapper (untested)
            - iOS
            - MacOS
- OOP-style Vulkan-optimized Application framework (PasVulkanApplication.pas PasVulkanAndroid.pas PasVulkanSDL2.pas PasVulkanStarticLinking.pas)
    - The overall design of this Vulkan-optimized Application framework is mixture between the VCL/LCL/FCL and libGDX design concepts (and some of my own design ideas, of course).
    - It uses SDL 2.x as OS-API abstraction layer API
    - Single-window-only, so it is cross-platform-friendly to the maximum, as far as it is possible.
        - For multi-window applications, you must do your own stuff (for example, own framework or using the VCL/LCL etc.), because it is out of the focus of the targets from this Vulkan-optimized Application framework
    - Automatic recovery for:
        - VK_ERROR_SURFACE_LOST_KHR
        - VK_ERROR_OUT_OF_DATE_KHR
        - VK_SUBOPTIMAL_KHR
        - but not for, for example, VK_ERROR_DEVICE_LOST, VK_ERROR_OUT_OF_DEVICE_MEMORY or VK_ERROR_OUT_OF_HOST_MEMORY, because that are critical situations, which you must handle yourself.
    - Automatic Swap Chain creation and recreation
    - Re-abstraction of the SDL2 abstraction, for the possible future case, when this Vulkan-optimized Application framework will be not SDL 2.0 based for possible further following target platforms, the Nintendo Switch as example, or when this Vulkan-optimized Application framework will be no more SDL 2.0 based for some already supported target platforms.  
    - Supported platforms:
        - Windows (x86-32, x86-64)
        - Android (x86-32, x86-64, ARM) (with SDL2 with some own patches, so that SDL2 is even under Android Vulkan-friendly)
        - Linux (x86-32, x86-64, ARM)
            - X11
            - Mir
            - Wayland
        - But no MoltenVK yet (since SDL 2.x has no support for it yet, so far I know) 
            
## License (zlib)

    Copyright (C) 2016-2017, Benjamin Rosseaux (benjamin@rosseaux.de)          
                                                                             
    This software is provided 'as-is', without any express or implied          
    warranty. In no event will the authors be held liable for any damages      
    arising from the use of this software.                                     
                                                                             
    Permission is granted to anyone to use this software for any purpose,     
    including commercial applications, and to alter it and redistribute it    
    freely, subject to the following restrictions:                            
 
    1. The origin of this software must not be misrepresented; you must not    
       claim that you wrote the original software. If you use this software    
       in a product, an acknowledgement in the product documentation would be  
       appreciated but is not required.                                        
    2. Altered source versions must be plainly marked as such, and must not be 
       misrepresented as being the original software.                          
    3. This notice may not be removed or altered from any source distribution. 
     
## General guidelines for code contributors 

 1. Make sure you are legally allowed to make a contribution under the zlib license.
 2. The zlib license header goes at the top of each source file, with appropriate copyright notice.
 3. This PasVulkan wrapper may be used only with the PasVulkan-own Vulkan Pascal header.
 4. After a pull request, check the status of your pull request on https://github.com/BeRo1985/pasvulkan
 5. Write code, which is compatible with Delphi 7-XE7 and FreePascal >= 3.0.2 so don't use generics/templates, operator overloading and another newer syntax features than Delphi 7 has support for that, but if needed, make it out-ifdef-able.   
 6. Don't use Delphi-only, FreePascal-only or Lazarus-only libraries/units, but if needed, make it out-ifdef-able.
 7. No use of third-party libraries/units as possible, but if needed, make it out-ifdef-able.                       
 8. Try to use const when possible.
 9. Make sure to comment out writeln, used while debugging.
 10. Make sure the code compiles on 32-bit and 64-bit platforms (x86-32, x86-64, ARM, ARM64, etc.).
 11. Make sure the code runs on all platforms with Vulkan support           
          
## Showcase videos

- PasVulkan on Android 7.0 on a NVIDIA Shield K1 Tablet
  [![PasVulkan on Android 7.0 on a NVIDIA Shield K1 Tablet](https://img.youtube.com/vi/HzK4BriAztM/0.jpg?a)](https://www.youtube.com/watch?v=HzK4BriAztM)


